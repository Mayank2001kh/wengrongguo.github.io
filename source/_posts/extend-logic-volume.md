title: 扩容Linux系统的逻辑分区
date: 2016-02-26 16:36:30
tags:
- linux
categories:
- linux
---

## 场景说明

本次项目组申请的服务器是运行在虚机上面，运维人员用80G的模板扩容到200G，所以磁盘还剩下有120G空间，项目组需要自己去把这剩下的120G空间进行分配

## 分析当前系统的磁盘分配情况

### 用df -h命令查看挂载信息

从图中可以看出，系统的挂载目录一共有5个，总容量约为80G，这就是运维人员用80G模版创建的系统的磁盘划分情况

{% asset_img 2.png 查看挂载信息 %}

### 用vgdisplay命令查看系统是否有逻辑分区组

从图中可以看出，系统存在一个逻辑分区组rootvg，并且使用的磁盘分区为/dev/sdb2，空间为79.8G

{% asset_img 3.png 查看系统逻辑分区组 %}

### 用lvdisplay命令查看系统的逻辑分区情况

从图中可以看出，rootvg逻辑分区组一共分区四个逻辑分区，每个逻辑分区的容量加起来一共79.8G，刚好把逻辑分区组的空间全部分配完

{% asset_img 4.png 查看系统的逻辑分区 %}

### 用fdisk -l命令查看磁盘信息

从图中可以看出，/dev/sda以及/dev/sdb约200G，而这台虚机的磁盘也只有200G，说明这两个设备映射的都是同一个磁盘，也就是我们接下来需要进行操作的一个磁盘设备。另外，这个磁盘设备被分为两个分区，从之前的查看逻辑分区组信息，我们知道逻辑分组用的设备刚好是sdb2，说明第二个分区上面是创建了一个物理分区，空间大小为79.8G，加上/dev/sdb1占用的空间，可以得到/dev/sdb还剩下约120G空间暂为使用

{% asset_img 1.png 查看磁盘信息 %}

## 确定分配方案

从上个步骤我们知道磁盘还剩下120G空间以及整个磁盘的分配情况，我们可以有如下两种方案：

* 在/dev/sdb上新建一个分区，把剩余的空间全部分配给这个新分区，新建一个挂载目录，把新分区挂载到这个新的目录上面，即可完成对磁盘剩余空间的分配
* 在/dev/sdb上新建一个分区，在这个新分区上创建一个物理分区，把这个物理分区分配给rootvg逻辑分区组进行扩容，这样就可以在逻辑分区组的基础上创建新的逻辑分区或者对已有的某个逻辑分区进行扩容

本次我们采取的是第二种方案，对逻辑分区组进行扩容，这种做法更灵活，更为许多企业采用，而且可以对已有的逻辑分区进行扩容，刚好我们想要对已有/opt目录进行扩容，正好合适

## 方案实施

### 用fdisk /dev/sdb对/dev/sdb磁盘设备进行分区

{% asset_img 2-1.png fdisk /dev/sdb %}

这是一个命令交互界面，我们可以输入m查看所有选项，p是输出已有的分区，所以我们输入p查看到已有的分区有两个

{% asset_img 2-2.png 查看已有分区 %}

输入n创建一个新分区，选择p分区类型为primary partition，分区编号为3，因为前面已经有两个分区了，接下来磁盘扇区的起始位置和终止位置直接回车把剩余空间全部分配给这个新分区

{% asset_img 2-3.png 创建新分区 %}

输入t修改分区类型，选择新建的分区3，将分区类型调整为8e，因为我们需要在上面建立物理分区

{% asset_img 2-4.png 修改分区类型 %}

输入p输出所有分区信息，查看修改是否无误

{% asset_img 2-5.png 确认分区是否无误 %}

确认无误后，输入w保存修改并退出

{% asset_img 2-6.png 保存修改并退出 %}

### 用pvcreate /dev/sdb3命令，基于/dev/sdb3新建一个物理分区

{% asset_img 2-7.png 创建物理分区 %}

### 用vgextend rootvg /dev/sdb3命令扩容逻辑卷组

将新建的物理分区分配给rootvg逻辑分区组进行扩容，用vgdisplay命令可以看到逻辑分区组增加了120G未分配空间

{% asset_img 2-8.png 扩容逻辑卷组 %}

### 用lvextend -l +100%FREE /dev/rootvg/lv_opt命令扩容逻辑分区

我们想要扩容的是/opt目录，从第二个步骤我们知道了/opt目录对应的逻辑分区是/dev/rootvg/lv_opt，所以我们把逻辑分区组rootvg剩余的空间都分配给它

{% asset_img 2-9.png 扩容逻辑分区 %}

### 用resize2fs /dev/rootvg/lv_opt命令刷新逻辑分区的大小

{% asset_img 2-10.png 刷新逻辑分区大小 %}

### 用df -h查看到/opt目录已经成功扩容

{% asset_img 2-11.png 查看挂载信息 %}

